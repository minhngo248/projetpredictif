<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->

<html>
    <head>
        <meta charset="UTF-8">
        <title>Choisir son médium</title>
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>
            function initPages() {
            // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'consulter-liste-medium'
                    },
                    dataType: 'json'
                })
                .done(function (response) {
                    var listeMedium = response.listeMed;
                    $.each(listeMedium, function (index, medium) {
                        $('#listeMedium').append("<div class='newDiv'><span>" +
                                medium.presentation + "     " + medium.denomination + "</span>    " +
                                "<button id=" + medium.idMedium + 
                            " onClick='obtenirMedium(this.id)'>Obtenir une consultation </button>" + "</div>");
                        });

                })
                .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                    console.log('Error', error); // LOG dans Console Javascript
                    alert("Erreur lors du chargement des donnees: HTTP Code " + error.status);
                });
            }

            function obtenirMedium(idMedium) {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'obtenir-consultation',
                        idMedium: idMedium
                    },
                    dataType: 'json'
                })
                .done(function(response) {
                    if (response.rdv !== null) {
                        alert("Confirmé\n    Vous recevrez bientôt un SMS.");
                        window.location = "accueilClient.html"; 
                    } else {
                        alert("Ce voyant est en consultation. \n    Réesssayez plus tard !");
                    }    
                           
                })
                .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                    console.log('Error', error); // LOG dans Console Javascript
                    alert("Erreur lors du chargement des donnees: HTTP Code " + error.status);
                });
                
            }

            $(document).ready(function () {
                initPages();
            });
        </script>        
    </head>
    <body>
        <h1>Choisir un médium</h1>
        <a href="#">Trouver un médium</a>
        <a href="accueilClient.html">Profil</a>
        <a href="loginClient.html">Déconnexion</a>

       
        
        <form>
                    <label for="tri">Trier par :</label>
                    <select name="tri" id="tri">
                        <option value="Professions">Professions</option>
                        <option value="Alphabétique">Alphabétique</option>
                    </select>
                    <br><br>
                    <input type="submit" value="Lancer la recherche">
                </form>

        <div>
            <fieldset>
                <legend>Professions à afficher</legend>
                <div>
                    <input type="checkbox" id="cartomancien" name="cartomancien">
                    <label for="cartomancien">Cartomancien</label>

                    <input type="checkbox" id="spirites" name="spirites">
                    <label for="spirites">Spirites</label>

                    <input type="checkbox" id="astrologues" name="astrologues">
                    <label for="astrologues">Astrologues</label>
                </div>
            </fieldset>
        </div>
        <div id="second_div">
            <h2>Médium disponible</h2>    
            <div id="listeMedium">
            </div>
        </div>

    </body>
</html>

